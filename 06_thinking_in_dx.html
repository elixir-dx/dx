<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="dx main">


    <title>Thinking in Dx ‚Äî dx main</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-93957DE4.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="Dx.html" class="sidebar-projectName" translate="no">
dx
        </a>
        <div class="sidebar-projectVersion" translate="no">
          main
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Guides (old)
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of dx</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/elixir-dx/dx/blob/a8757c094f0503b5ae8ecbb5ee558c81256cd343/docs/basics/06_thinking_in_dx.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Thinking in Dx</span>
  </h1>

<p>When working with Dx, we have to think top-down, as opposed to bottom-up.
We always start from the end result, which we want to achieve.
Any logic and inputs needed to get to the end result are defined within Dx.</p><h3 id="example" class="section-heading">
  <a href="#example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h3>
<p>Say we have a complex requirement to implement:</p><blockquote><p>A user can archive a Todo list, but only if they created it, or if they have an &quot;admin&quot; role,
and only if all tasks in the list are completed.</p></blockquote><p>Let's assume we only have the schema, and no other functions, helpers, or rules defined.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Todo.User</span><span class="w"> </span><span class="k" data-group-id="2052630304-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Dx.Ecto.Schema</span><span class="p">,</span><span class="w"> </span><span class="ss">repo</span><span class="p">:</span><span class="w"> </span><span class="nc">Todo.Repo</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s">&quot;users&quot;</span><span class="w"> </span><span class="k" data-group-id="2052630304-2">do</span><span class="w">
    </span><span class="n">has_many</span><span class="w"> </span><span class="ss">:roles</span><span class="p">,</span><span class="w"> </span><span class="nc">Todo.UserRole</span><span class="w">
  </span><span class="k" data-group-id="2052630304-2">end</span><span class="w">
</span><span class="k" data-group-id="2052630304-1">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Todo.UserRole</span><span class="w"> </span><span class="k" data-group-id="2052630304-3">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Dx.Ecto.Schema</span><span class="p">,</span><span class="w"> </span><span class="ss">repo</span><span class="p">:</span><span class="w"> </span><span class="nc">Todo.Repo</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s">&quot;user_roles&quot;</span><span class="w"> </span><span class="k" data-group-id="2052630304-4">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="nc">Ecto.Enum</span><span class="p">,</span><span class="w"> </span><span class="ss">values</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2052630304-5">[</span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:super_admin</span><span class="p" data-group-id="2052630304-5">]</span><span class="w">

    </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="nc">Todo.User</span><span class="w">
  </span><span class="k" data-group-id="2052630304-4">end</span><span class="w">
</span><span class="k" data-group-id="2052630304-3">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Todo.List</span><span class="w"> </span><span class="k" data-group-id="2052630304-6">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Dx.Ecto.Schema</span><span class="p">,</span><span class="w"> </span><span class="ss">repo</span><span class="p">:</span><span class="w"> </span><span class="nc">Todo.Repo</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s">&quot;lists&quot;</span><span class="w"> </span><span class="k" data-group-id="2052630304-7">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:archived_at</span><span class="p">,</span><span class="w"> </span><span class="ss">:utc_datetime</span><span class="w">

    </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:created_by</span><span class="p">,</span><span class="w"> </span><span class="nc">Todo.User</span><span class="w">
  </span><span class="k" data-group-id="2052630304-7">end</span><span class="w">
</span><span class="k" data-group-id="2052630304-6">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Todo.Task</span><span class="w"> </span><span class="k" data-group-id="2052630304-8">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Dx.Ecto.Schema</span><span class="p">,</span><span class="w"> </span><span class="ss">repo</span><span class="p">:</span><span class="w"> </span><span class="nc">Todo.Repo</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s">&quot;tasks&quot;</span><span class="w"> </span><span class="k" data-group-id="2052630304-9">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:completed_at</span><span class="p">,</span><span class="w"> </span><span class="ss">:utc_datetime</span><span class="w">

    </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:list</span><span class="p">,</span><span class="w"> </span><span class="nc">Todo.List</span><span class="w">
  </span><span class="k" data-group-id="2052630304-9">end</span><span class="w">
</span><span class="k" data-group-id="2052630304-8">end</span></code></pre><p>The inputs are the <code class="inline">list</code> to be archived and the <code class="inline">current_user</code> who tries to archive it.
The end result is either the now archived list, or an error.</p><p>Without Dx, we'd write a function that takes the <code class="inline">list</code> and the <code class="inline">user</code> who tries to archive it.
We'd then have to think about <strong>how</strong> to load the data needed to compute the result, and implement it.</p><p>With Dx, we don't have to think about <strong>how</strong> to load the data or compute the result.
Instead, we focus entirely on <strong>what</strong> is relevant and write the rules to represent this logic.
Dx then takes care of loading data as needed, in an efficient way.</p><p>Thinking in Dx, we usually take the following steps:</p><ol><li><p> What are the possible end results that we need to continue in our other code, f.ex. a web request?
In our example, the end result can be either &quot;archive the list&quot; or &quot;can't archive list&quot;.
In code terms, we could return <code class="inline">true</code> or <code class="inline">false</code>, or we could return <code class="inline">:ok</code> or <code class="inline">{:error, reason}</code>.</p><p><em>Note:</em> We think of Dx as read-only; we don't perform an action (such as archiving a list),
but prepare and compute all the data needed to do it.</p></li><li><p> What is the primary data point, on which to operate on?
In our example, it's rather easy: we operate on a <code class="inline">list</code>.
In other cases, there might be multiple candidates; in these cases, it might help to ask
what data type feels most intuitive to return the end results conceived in step 1.</p></li><li><p> Define a predicate on the main data type from step 2 with the possible values from step 1.
In the code where the outcome is used, f.ex. a web request, call <a href="Dx.html"><code class="inline">Dx</code></a> with the main data point
and this predicate. We also add additional data needed as <code class="inline">args</code>.</p><p>In our example:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># in Todo.List</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="ss">:ok</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2533681022-1">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:unauthorized</span><span class="p" data-group-id="2533681022-1">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2533681022-2">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:pending_tasks</span><span class="p" data-group-id="2533681022-2">}</span><span class="w">

</span><span class="c1"># in the List controller</span><span class="w">
</span><span class="k">with</span><span class="w"> </span><span class="ss">:ok</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">Dx</span><span class="o">.</span><span class="n">load!</span><span class="p" data-group-id="2533681022-3">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="ss">:archivable?</span><span class="p">,</span><span class="w"> </span><span class="ss">args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2533681022-4">[</span><span class="ss">current_user</span><span class="p">:</span><span class="w"> </span><span class="n">current_user</span><span class="p" data-group-id="2533681022-4">]</span><span class="p" data-group-id="2533681022-3">)</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="2533681022-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">archived_list</span><span class="p" data-group-id="2533681022-5">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">List</span><span class="o">.</span><span class="n">archive</span><span class="p" data-group-id="2533681022-6">(</span><span class="n">list</span><span class="p" data-group-id="2533681022-6">)</span><span class="w"> </span><span class="k" data-group-id="2533681022-7">do</span><span class="w">
  </span><span class="n">render</span><span class="p" data-group-id="2533681022-8">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;show.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">list</span><span class="p">:</span><span class="w"> </span><span class="n">archived_list</span><span class="p" data-group-id="2533681022-8">)</span><span class="w">
</span><span class="k" data-group-id="2533681022-7">end</span></code></pre></li><li><p> Flesh out the conditions for the various cases. For each condition, think about what's needed
and how it could be called. If there's a good answer, use the term in the condition as if it
already existed. This way, it's easier to stay on the requirements level, using terms that make
sense in the app's domain.</p><p>In our example, we also reverse the order, checking all error cases first,
and returning <code class="inline">:ok</code> otherwise:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># in Todo.List</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0492351402-1">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:unauthorized</span><span class="p" data-group-id="0492351402-1">}</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0492351402-2">%{</span><span class="ss">can_archive?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0492351402-2">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0492351402-3">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:pending_tasks</span><span class="p" data-group-id="0492351402-3">}</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0492351402-4">%{</span><span class="ss">tasks</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0492351402-5">%{</span><span class="ss">completed?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0492351402-5">}</span><span class="p" data-group-id="0492351402-4">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="ss">:ok</span></code></pre></li><li><p> Define the predicates you used on the correct schema types, and continue the process until the
requirements are fully defined using rules.</p><p>In our example, the final set of rules might look like this:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># in Todo.List</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-1">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:unauthorized</span><span class="p" data-group-id="0668179961-1">}</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-2">%{</span><span class="ss">can_archive?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0668179961-2">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-3">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:pending_tasks</span><span class="p" data-group-id="0668179961-3">}</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-4">%{</span><span class="ss">tasks</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-5">%{</span><span class="ss">completed?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0668179961-5">}</span><span class="p" data-group-id="0668179961-4">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="ss">:ok</span><span class="w">

</span><span class="n">infer</span><span class="w"> </span><span class="ss">can_archive?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-6">%{</span><span class="ss">args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-7">%{</span><span class="ss">current_user</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-8">%{</span><span class="ss">is_admin?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="0668179961-8">}</span><span class="p" data-group-id="0668179961-7">}</span><span class="p" data-group-id="0668179961-6">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">can_archive?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-9">%{</span><span class="ss">is_owner?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="0668179961-9">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">can_archive?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">

</span><span class="n">infer</span><span class="w"> </span><span class="ss">is_owner?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-10">%{</span><span class="ss">created_by_id</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-11">{</span><span class="ss">:ref</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0668179961-12">[</span><span class="ss">:args</span><span class="p">,</span><span class="w"> </span><span class="ss">:current_user</span><span class="p">,</span><span class="w"> </span><span class="ss">:id</span><span class="p" data-group-id="0668179961-12">]</span><span class="p" data-group-id="0668179961-11">}</span><span class="p" data-group-id="0668179961-10">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">is_owner?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">

</span><span class="c1"># in Todo.User</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">is_admin?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-13">%{</span><span class="ss">roles</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-14">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-15">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:super_admin</span><span class="p" data-group-id="0668179961-15">]</span><span class="p" data-group-id="0668179961-14">}</span><span class="p" data-group-id="0668179961-13">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">is_admin?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">

</span><span class="c1"># in Todo.Task</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">completed?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">when</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-16">%{</span><span class="ss">completed_at</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0668179961-17">{</span><span class="ss">:not</span><span class="p">,</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="0668179961-17">}</span><span class="p" data-group-id="0668179961-16">}</span><span class="w">
</span><span class="n">infer</span><span class="w"> </span><span class="ss">completed?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span></code></pre></li></ol><h3 id="other-use-cases-covered" class="section-heading">
  <a href="#other-use-cases-covered" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Other use cases covered</span>
</h3>
<p>We could use the rules we defined to cover other use cases as well:</p><h4>Filtering archivable lists</h4><p>Say we have a list of <code class="inline">Todo.List</code> structs, and want to keep only the ones that can be archived,
for example to implement a web request to archive multiple lists. We use <a href="Dx.html#filter/3"><code class="inline">Dx.filter/3</code></a> for it,
which takes a list of data as well as a condition, just like the ones we use when defining rules:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Dx</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="1246946643-1">(</span><span class="n">lists</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246946643-2">%{</span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="ss">:ok</span><span class="p" data-group-id="1246946643-2">}</span><span class="p">,</span><span class="w"> </span><span class="ss">args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1246946643-3">[</span><span class="ss">current_user</span><span class="p">:</span><span class="w"> </span><span class="n">current_user</span><span class="p" data-group-id="1246946643-3">]</span><span class="p" data-group-id="1246946643-1">)</span></code></pre><h4>Querying all archivable lists</h4><p>Say we want to query all lists that a given user can archive. We use <a href="Dx.html#query_all/3"><code class="inline">Dx.query_all/3</code></a> for it,
which takes a type as well as a condition, just like the ones we use when defining rules:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Dx</span><span class="o">.</span><span class="n">query_all</span><span class="p" data-group-id="4480095291-1">(</span><span class="nc">Todo.List</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4480095291-2">%{</span><span class="ss">archivable?</span><span class="p">:</span><span class="w"> </span><span class="ss">:ok</span><span class="p" data-group-id="4480095291-2">}</span><span class="p">,</span><span class="w"> </span><span class="ss">args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4480095291-3">[</span><span class="ss">current_user</span><span class="p">:</span><span class="w"> </span><span class="n">current_user</span><span class="p" data-group-id="4480095291-3">]</span><span class="p" data-group-id="4480095291-1">)</span></code></pre>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="05_arguments.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ‚Üê Previous Page
        </span>
        <span class="title">
Arguments
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="99_outro.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page ‚Üí
        </span>
        <span class="title">
Done üéâ
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/dx/0.0.0" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/dx/0.0.0">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/dx/0.0.0/show/docs/basics/06_thinking_in_dx.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="dx.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
